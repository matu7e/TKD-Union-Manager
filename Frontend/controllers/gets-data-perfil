document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM completamente cargado y parseado');
                    // Función para decodificar JWT
            
                // Obtener el token desde el almacenamiento local o sesión
                console.log('antes de buscar el token')
                const token = localStorage.getItem('authToken'); // Ajusta si usas sessionStorage
                console.log('despues de buscar el token')
                if (!token) {
                    console.error('Token no encontrado. Redirigiendo a la página de inicio de sesión.');
                    window.location.href = '../src/login.html'; // Redirige si no hay token
                } else {
                    try {
                        // Decodificar el token
                        console.log('Token encontrado. Decodificando...');
                        const decodedToken = jwt_decode(token);
                        console.log('Token decodificado:', decodedToken);
            
                        const dni = decodedToken.dni;
                        const userStatus = decodedToken.estado;
            
                        console.log('DNI:', dni);
                        console.log('Estado del usuario:', userStatus);
            
                        if (userStatus === false) {
                            console.log('Usuario inactivo. Redirigiendo a la página de pago...');
                            window.location.href = 'https://www.mercadopago.com.ar/...';
                        } else if (userStatus === true) {
                            console.log('Usuario activo. Cargando perfil...');
                        } else {
                            alert('Estado de usuario no reconocido');
                            return;
                        }
            
                        // Obtener los datos del perfil del usuario usando el DNI
                        console.log(`Realizando fetch para el DNI: ${dni}`);
                        fetch(`http://localhost:3000/miembros/${dni}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}` // Envía el token JWT en el encabezado
                            }
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Error en la red: ' + response.statusText);
                            }
                            console.log('Respuesta del servidor:', response);
                            return response.json();
                        })
                        .then(data => {
                            console.log('Datos del usuario recibidos:', data);
            
                            // Verificar si el usuario está activo
                            if (!data.activo) {
                                console.warn('El usuario no está activo. Redirigiendo a la página de inicio de sesión.');
                                alert('El usuario no está activo.');
                                window.location.href = '../src/login.html';
                                return;
                            }
            
                            // Datos personales
                            document.getElementById('firstName').value = data.nombre;
                            document.getElementById('lastName').value = data.apellido;
                            document.getElementById('dni').value = data.dni_miembro;
                            document.getElementById('dob').value = data.fecha_nacimiento.split('T')[0]; // Formato YYYY-MM-DD
                            document.getElementById('bloodGroup').value = data.grupo_sanguineo;
            
                           // Imagen
                            const avatarPath = `../../Backend/uploads/avatares/${data.imagen}`;
                            const avatarElement = document.querySelector('.user-info .avatar'); // Seleccionar el elemento correctamente

                            if (data.imagen != null) {
                                avatarElement.src = avatarPath;
                            } else {
                                avatarElement.src = '../../Backend/uploads/default.jpg';
                            }
                            // Datos de contacto
                            document.getElementById('phone').value = data.telefono;
                            document.getElementById('email').value = data.email;
                            document.getElementById('address').value = data.direccion;
            
                            // Datos del tutor
                            document.getElementById('tutorDNI').value = data.dni_tutor;
                            document.getElementById('relationship').value = data.relacion_tutor;


                            fetch(`http://localhost:3000/tutores/${data.dni_tutor}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}` // Envía el token JWT en el encabezado
                            }
                            })
                            
                            
                            .then(response => response.json())
                            .then(data2 => {
                                console.log('Datos del tutor recibidos:', data2);
                                // Rellenar los campos del formulario con los datos del tutor
                                document.getElementById('tutorFirstName').value = data2.nombre;
                                document.getElementById('tutorLastName').value = data2.apellido;
                                document.getElementById('tutorPhone').value = data2.telefono;
                            })
                            .catch(error => {
                                console.error('Error al obtener los datos del tutor:', error);
                            });








                            // Cargar opciones dinámicas en los selectores
                            const cintoSelect = document.getElementById('cinto');
                            const escuelaSelect = document.getElementById('escuela');
            
                            // Vaciar el contenido actual
                            cintoSelect.innerHTML = '<option value="">Selecciona un cinto</option>';
                            escuelaSelect.innerHTML = '<option value="">Selecciona su escuela</option>';
            
                            // Agregar la opción del cinto
                            const beltOption = document.createElement('option');
                            beltOption.value = data.cinto; // Asume que el cinto es un identificador único
                            beltOption.text = data.cinto; // Nombre del cinto
                            cintoSelect.appendChild(beltOption);
            
                            // Agregar opciones de escuela si hay datos disponibles
                            if (data.escuela) {
                                const schoolOption = document.createElement('option');
                                schoolOption.value = data.escuela; // Asume que hay un id de escuela
                                schoolOption.text = data.escuela; // Nombre de la escuela
                                escuelaSelect.appendChild(schoolOption);
                            }
                        })
                        .catch(error => {
                            console.error('Error al cargar los datos:', error);
                        });
                    } catch (error) {
                        console.error('Error al decodificar el token:', error);
                    }
                }
                 });